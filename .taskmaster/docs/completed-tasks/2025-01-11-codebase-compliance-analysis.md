# An√°lise Completa do Sistema de Conformidade de Avia√ß√£o

**Data:** 11 de Janeiro de 2025  
**Task ID:** compliance-analysis-002  
**Status:** ‚úÖ An√°lise Conclu√≠da  
**Branch:** 003-projeto-de-microservi  

---

## üìã Objetivo

Revisar o codebase completo para identificar:
1. Onde est√£o os detalhamentos t√©cnicos das aeronaves
2. Onde est√£o as conformidades regulat√≥rias entre pa√≠ses
3. Estrutura do banco de dados de compliance
4. Integra√ß√£o entre frontend e backend

---

## üîç Descobertas

### 1. **Detalhamento T√©cnico das Aeronaves**

#### üìç Localiza√ß√£o Principal: `aviation-frontend-v2/src/data/aircraftData.ts`

**Estrutura de Dados por Aeronave:**
```typescript
{
  id: string,
  model: string,                    // Ex: "E175-E2", "Phenom 300E"
  category: 'commercial' | 'executive' | 'defense' | 'agriculture',
  categoryLabel: string,            // Ex: "Avia√ß√£o Comercial"
  categoryColor: string,            // Cor Embraer: "#0E1C59"
  badge: string,                    // Ex: "Nova Gera√ß√£o", "Best Seller"
  image: string,                    // Caminho local: "/planes/E175-E2.png"
  heroImage: string,
  
  specs: {
    capacity: string,               // Ex: "80-90 passageiros"
    range: string,                  // Ex: "4,815 km"
    speed: string,                  // Ex: "Mach 0.82"
    engines: string,                // Ex: "Pratt & Whitney PW1715G"
    length: string,                 // Ex: "31.68 m"
    wingspan: string,
    height: string,
    maxWeight: string,
    cruiseSpeed: string,
    maxAltitude: string,
  },
  
  highlights: string[],             // Principais caracter√≠sticas
  technologicalFeatures: any[],     // Features tecnol√≥gicas
  description: string,
  status: 'operational'
}
```

**Total de Aeronaves Detalhadas:** 15 modelos

**Categorias:**
- ‚úàÔ∏è **Comercial (E-Jets):** 7 aeronaves
  - E175-E2, E190-E2, E195-E2 (Nova Gera√ß√£o)
  - E170, E175, E190, E195 (Primeira Gera√ß√£o)

- üõ©Ô∏è **Executiva:** 4 aeronaves
  - Phenom 100EV, Phenom 300E
  - Praetor 500, Praetor 600

- üöÅ **Defesa:** 3 aeronaves
  - KC-390 Millennium, C-390 Millennium
  - A-29 Super Tucano

- üåæ **Agr√≠cola:** 1 aeronave
  - EMB-202 Ipanema (movida a etanol)

---

### 2. **Sistema de Conformidade Regulat√≥ria**

#### üìç Backend: Python FastAPI

**Arquivos Principais:**

1. **`src/models/compliance.py`** - Modelos Pydantic:
   ```python
   class ComplianceReport:
       aircraft_model: str
       country: str
       overall_status: "COMPLIANT" | "NON_COMPLIANT" | "PARTIAL_COMPLIANCE"
       total_checks: int
       compliant_checks: int
       non_compliant_checks: int
       critical_issues: int
       checks: List[ComplianceCheck]
       recommendations: List[str]
       aircraft_info: AircraftInfo
   ```

2. **`src/services/compliance_service.py`** - L√≥gica de Neg√≥cio:
   - Valida√ß√£o de modelos e pa√≠ses
   - Verifica√ß√£o de conformidade
   - Integra√ß√£o com Redis (cache)
   - Suporte a 15 modelos Embraer
   - Suporte a 3 pa√≠ses: USA, BRAZIL, EUROPE

3. **`src/api/compliance.py`** - Endpoints REST:
   - `GET /compliance/check/{model}/{country}`
   - Retorna relat√≥rio completo de conformidade

---

### 3. **Banco de Dados SQLite (`projetoaviacao.db`)**

#### üìä Estrutura Completa

**Tabelas Principais:**

1. **`authorities`** (3 registros)
   - ANAC (Brasil) - Ag√™ncia Nacional de Avia√ß√£o Civil
   - FAA (USA) - Federal Aviation Administration
   - EASA (Europa) - European Union Aviation Safety Agency
   
   ```
   Campos: id, code, name, country, website, created_at, updated_at
   ```

2. **`aircraft_models`** (8 registros)
   ```
   Modelos no DB:
   ‚Ä¢ Airbus A320-A320neo         | Transport | 195 assentos
   ‚Ä¢ Boeing 737-737-800          | Transport | 189 assentos
   ‚Ä¢ Embraer E175-E175-E1        | Transport |  88 assentos
   ‚Ä¢ Embraer E175-E175-E2        | Transport |  90 assentos
   ‚Ä¢ Embraer E190-E190-E1        | Transport | 114 assentos
   ‚Ä¢ Embraer E190-E190-E2        | Transport | 114 assentos
   ‚Ä¢ Embraer E195-E195-E1        | Transport | 122 assentos
   ‚Ä¢ Embraer E195-E195-E2        | Transport | 146 assentos
   ```
   
   ```
   Campos: id, manufacturer, model, variant, type_certificate, 
           category, max_seats, max_weight_kg, created_at, updated_at
   ```

3. **`regulations`** (13 registros)
   
   Exemplos:
   - **ANAC:** RBAC 21 - Certifica√ß√£o de Produto Aeron√°utico
   - **ANAC:** RBAC 91 - Requisitos Gerais de Opera√ß√£o
   - **ANAC:** RBAC 121.445 - Emergency Equipment Requirements
   - **ANAC:** RBAC 25.841 - Pressurization System Requirements
   - **FAA:** TCDS A57NM - Embraer ERJ 190
   - **FAA:** AD-2025-12 - Wing inspection required
   - **FAA:** 14 CFR 25.562 - Emergency Landing Dynamic Conditions
   - **EASA:** TCDS EASA.IM.A.071 - ERJ 190
   - **EASA:** CS-25.1309 - Equipment, Systems, and Installations
   
   ```
   Campos: id, authority_id, reference, title, description, 
           category, subcategory, status, effective_date, 
           content (JSON), created_at, updated_at
   ```

4. **`compliance_checks`** (0 registros - tabela vazia)
   ```
   Campos: id, aircraft_model_id, regulation_id, status, severity,
           findings, recommendations, checked_by, checked_at,
           evidence_documents (JSON), extra_metadata (JSON),
           created_at, updated_at
   ```

5. **`compliance_reports`** (0 registros - tabela vazia)
   ```
   Campos: id, aircraft_model_id, title, summary, overall_status,
           report_type, generated_by, generated_at,
           extra_metadata (JSON), created_at, updated_at
   ```

6. **`regulation_models`** (tabela de relacionamento)
   - Liga regulamenta√ß√µes a modelos de aeronaves
   - Campos: regulation_id, aircraft_model_id

7. **`aircraft`** (0 registros)
   - Inst√¢ncias espec√≠ficas de aeronaves
   - Campos: id, name, aircraft_type, registration, current_hours, 
             last_inspection, created_at, updated_at

8. **`compliance_requirements`** (0 registros)
   - Requisitos de conformidade por tipo de aeronave
   - Campos: id, title, description, authority, frequency_hours,
             aircraft_types, priority, created_at, updated_at

---

### 4. **Frontend v2 - Estrutura Atual**

#### üìç Localiza√ß√£o: `aviation-frontend-v2/`

**Componentes Existentes:**

1. **`src/types/aircraft.ts`** - TypeScript Interfaces:
   ```typescript
   interface Aircraft {
     id: string;
     model: string;
     category: 'commercial' | 'executive' | 'defense' | 'agriculture';
     specs?: any;
     certifications?: string[];  // ‚ö†Ô∏è CAMPO DISPON√çVEL MAS N√ÉO UTILIZADO
     // ... outros campos
   }
   ```

2. **`src/components/AircraftCard.tsx`**
   - Card visual para exibir aeronave
   - Mostra: imagem, specs, performance, highlights

3. **`src/pages/EmbraerDashboard.tsx`**
   - Dashboard principal com 4 se√ß√µes
   - Agrupa aeronaves por categoria
   - Cards de estat√≠sticas

**Componentes AUSENTES (necess√°rios):**
- ‚ùå `ComplianceChecker.tsx` - Verificador de conformidade
- ‚ùå `AircraftDetails.tsx` - Detalhes completos da aeronave
- ‚ùå `ComplianceReport.tsx` - Relat√≥rio de conformidade
- ‚ùå `RegulationsList.tsx` - Lista de regulamenta√ß√µes aplic√°veis

---

## üéØ Gap Analysis

### ‚ùå **Problemas Identificados:**

1. **Desconex√£o Frontend ‚Üî Backend**
   - Frontend v2 n√£o consome API de compliance
   - N√£o h√° integra√ß√£o com `projetoaviacao.db`
   - Campo `certifications` existe mas n√£o √© usado

2. **Dados Duplicados**
   - `aircraftData.ts` tem 15 modelos Embraer detalhados
   - `aircraft_models` (DB) tem apenas 8 modelos (incluindo Airbus/Boeing)
   - Falta sincroniza√ß√£o entre frontend e banco

3. **Falta de Componentes de Compliance**
   - N√£o h√° interface para verificar conformidade
   - N√£o h√° visualiza√ß√£o de regulamenta√ß√µes por pa√≠s
   - N√£o h√° relat√≥rios de compliance

4. **Informa√ß√µes Incompletas**
   - Aeronaves do frontend n√£o t√™m IDs do banco
   - N√£o h√° mapping entre modelos do frontend e IDs do DB
   - Certifica√ß√µes n√£o s√£o exibidas

---

## ‚úÖ **Recomenda√ß√µes de Implementa√ß√£o**

### **Fase 1: Sincroniza√ß√£o de Dados**

1. **Expandir `aircraft_models` no DB:**
   - Adicionar todos os 15 modelos Embraer do frontend
   - Incluir: Phenom 100EV, Phenom 300E, Praetor 500, Praetor 600
   - Incluir: KC-390, C-390, A-29 Super Tucano, EMB-202 Ipanema

2. **Adicionar Certifica√ß√µes no Frontend:**
   ```typescript
   certifications: [
     "FAA Type Certificate: A57NM",
     "EASA Type Certificate: EASA.IM.A.071",
     "ANAC Certificate: RBAC 21"
   ]
   ```

### **Fase 2: Novos Componentes**

1. **`ComplianceChecker.tsx`**
   ```tsx
   <ComplianceChecker>
     <AircraftSelector models={embraerAircraft} />
     <CountrySelector countries={['USA', 'BRAZIL', 'EUROPE']} />
     <CheckButton onClick={checkCompliance} />
     <ComplianceReport data={reportData} />
   </ComplianceChecker>
   ```

2. **`AircraftDetails.tsx`**
   - P√°gina detalhada com specs completas
   - Se√ß√£o de certifica√ß√µes por pa√≠s
   - Hist√≥rico de conformidade
   - Regulamenta√ß√µes aplic√°veis

3. **Servi√ßo de API:**
   ```typescript
   // src/services/complianceService.ts
   export async function checkCompliance(
     model: string, 
     country: string
   ): Promise<ComplianceReport> {
     const response = await axios.get(
       `/compliance/check/${model}/${country}`
     );
     return response.data;
   }
   ```

### **Fase 3: Rotas e Navega√ß√£o**

```typescript
// App.tsx com React Router
<Routes>
  <Route path="/" element={<EmbraerDashboard />} />
  <Route path="/aircraft/:id" element={<AircraftDetails />} />
  <Route path="/compliance" element={<ComplianceChecker />} />
  <Route path="/regulations" element={<RegulationsList />} />
</Routes>
```

---

## üìä M√©tricas do Sistema

- **Total de Aeronaves (Frontend):** 15 modelos Embraer
- **Total de Aeronaves (Backend DB):** 8 modelos (E-Jets apenas)
- **Autoridades Reguladoras:** 3 (ANAC, FAA, EASA)
- **Regulamenta√ß√µes:** 13 ativas
- **Pa√≠ses Suportados:** 3 (USA, BRAZIL, EUROPE)
- **Imagens Locais:** 16 arquivos em `/planes/`

---

## üóÇÔ∏è Arquivos Analisados

```
projetoAviacao/
‚îú‚îÄ‚îÄ aviation-frontend-v2/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aircraftData.ts         ‚≠ê 15 aeronaves detalhadas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aircraft.ts             ‚≠ê Interfaces TypeScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AircraftCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StatsCard.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ EmbraerDashboard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ public/
‚îÇ       ‚îî‚îÄ‚îÄ planes/                     ‚≠ê 16 imagens locais
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ compliance.py               ‚≠ê Modelos Pydantic
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ compliance_service.py       ‚≠ê L√≥gica de conformidade
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ compliance.py               ‚≠ê Endpoints REST
‚îÇ
‚îú‚îÄ‚îÄ projetoaviacao.db                   ‚≠ê Banco SQLite
‚îú‚îÄ‚îÄ mock_server.py                      ‚≠ê Servidor mock para testes
‚îî‚îÄ‚îÄ inspect_db.py                       ‚≠ê Script de an√°lise (novo)
```

---

## üîó Pr√≥ximos Passos

### **Prioridade ALTA:**

1. ‚úÖ **Criar script de popula√ß√£o do banco**
   - Adicionar 15 modelos Embraer ao `aircraft_models`
   - Popular `regulation_models` com relacionamentos

2. ‚úÖ **Criar componente `ComplianceChecker`**
   - Interface para selecionar aeronave e pa√≠s
   - Bot√£o "Verificar Conformidade"
   - Exibi√ß√£o de relat√≥rio

3. ‚úÖ **Integrar Frontend com Backend**
   - Configurar Axios para API de compliance
   - Criar servi√ßo `complianceService.ts`
   - Consumir endpoint `/compliance/check/{model}/{country}`

### **Prioridade M√âDIA:**

4. ‚è≥ Adicionar certifica√ß√µes nas aeronaves do frontend
5. ‚è≥ Criar p√°gina `AircraftDetails` com tabs (Specs, Compliance, Certifications)
6. ‚è≥ Implementar React Router para navega√ß√£o

### **Prioridade BAIXA:**

7. ‚è≥ Dashboard de analytics de compliance
8. ‚è≥ Hist√≥rico de verifica√ß√µes
9. ‚è≥ Exporta√ß√£o de relat√≥rios em PDF

---

## üìö Refer√™ncias

- **Backend API:** `http://localhost:8000/docs` (FastAPI Swagger)
- **Mock Server:** `mock_server.py` (porta 8000)
- **Frontend v2:** `http://localhost:5173` (Vite dev server)
- **Banco de Dados:** `projetoaviacao.db` (SQLite)
- **Documenta√ß√£o:** `CODEBASE_ANALYSIS_REPORT.md`

---

**Status Final:** ‚úÖ **An√°lise Completa - Pronto para Implementa√ß√£o**

üéØ **Pr√≥xima A√ß√£o Recomendada:** Criar script de popula√ß√£o do banco de dados com os 15 modelos Embraer do frontend.
